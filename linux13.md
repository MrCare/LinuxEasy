# 备份与恢复

## 1. 备份概述

### Linux 系统需要备份的数据

- `/root/`

- `/home/`

- `/var/spool/mail/`

- `/etc/`

- 其他目录：安装服务的数据
  
  - apache需要备份的数据
    
    - 配置文件
    
    - 网页主目录
    
    - 日志文件
  
  - mysql需要备份的数据
    
    - 源码包安装的mysql：`/usr/local/mysql/data`
    
    - RPM包安装的mysql：`/var/lib/mysql`

## 2. 备份工具

dump & restore

- `dump` + 选项 +备份之后的文件名 + 原文件or目录

| 选项       | 作用                                    |
| -------- | ------------------------------------- |
| `-level` | 十个备份级别，0完全备份，9第九次增量备份                 |
| `-f`     | 制定备份之后的文件名                            |
| `-u`     | 备份完成后把备份时间记录在`/etc/dumpdates` 文件      |
| `-v`     | 显示备份过程中更多的输出信息                        |
| `-j`     | 调用 bzlib 库压缩备份文件，其实就是把备份文件压缩为 .bz2 格式 |
| `-W`     | 显示允许被 dump 的分区的备份等级及备份时间              |

```bash
dump -0uj -f /root/boot.bak.bz2 /boot/    #备份命令，先执行一次完全备份，并压缩和更新备份时间
cat /etc/dumpdates    #查看备份时间文件
cp install.log /boot/    #复制日志文件到/boot分区
dump -1uj -f /root/boot.bak1.bz2 /boot/    #增量备份/boot分区，并压缩
dump -W    #查询分区备份时间及备份级别
```

- `restore` + 模式选项 + 选项 
  
  - 模式选项有四种，不能混用

| 模式选项 | 作用                   |
| ---- | -------------------- |
| `-C` | 比较备份数据和实际数据的变化       |
| `-i` | 进入交互模式，手工选择需要回复的文件   |
| `-t` | 查看模式，用于查看备份文件中拥有哪些数据 |
| `-r` | 还原模式，用于数据还原          |

| 选项   | 作用         |
| ---- | ---------- |
| `-f` | 制定备份文件的文件名 |






